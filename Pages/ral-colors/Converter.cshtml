@page "/ral-colors/converter"
@using Microsoft.AspNetCore.Mvc.Localization
@using protabula_com.Models
@model ConverterModel
@inject IViewLocalizer Localizer
@using System.Globalization
@{
    var culture = CultureInfo.CurrentUICulture.Name;
    var colorName = Model.SelectedColor?.GetLocalizedName(culture) ?? "";
    var ralNumber = Model.SelectedColor?.Number ?? "";

    // Dynamic SEO-optimized title and description when a color is selected
    if (Model.SelectedColor != null)
    {
        ViewData["Title"] = Localizer["TitleWithColor", ralNumber, colorName].Value;
        ViewData["MetaDescription"] = Localizer["MetaDescriptionWithColor", ralNumber, colorName].Value;
    }
    else
    {
        ViewData["Title"] = Localizer["Title"].Value;
        ViewData["MetaDescription"] = Localizer["MetaDescription"].Value;
    }

    ViewData["Breadcrumbs"] = new List<(string, string?, object?)>
    {
        (Localizer["BreadcrumbColors"].Value, "/ral-colors/Index", new Dictionary<string, string> { ["culture"] = culture }),
        (Localizer["Title"].Value, null, null)
    };
}

<h1>@ViewData["Title"]</h1>
<p class="text-secondary">@Localizer["Intro"]</p>

@{
    var autocompleteModel = new ColorAutocompleteModel(
        "colorSearch",
        Localizer["SearchPlaceholder"].Value,
        Model.AllColors,
        Model.SelectedColor?.Number);
}

<div class="converter-container">
    <div class="mb-lg">
        <partial name="Shared/_ColorAutocomplete" model="autocompleteModel" />
    </div>

    @if (Model.SelectedColor != null && Model.Formats != null)
    {
        <div class="converter-result">
            <div class="color-preview-box @(Model.SelectedColor.NeedsDarkText ? "dark" : "")"
                 style="background-color: @Model.Formats.Hex;">
                <span class="ral">RAL</span>
                <h2 class="number">@Model.SelectedColor.Number</h2>
                @if (!string.IsNullOrEmpty(colorName))
                {
                    <span class="name">@colorName</span>
                }
            </div>

            <!-- SEO-optimized heading for the conversion -->
            <h2 class="converter-seo-heading">@Localizer["ConvertHeading", ralNumber, colorName]</h2>
            <p class="converter-seo-text">@Localizer["ConvertDescription", ralNumber, colorName]</p>

            <div class="color-formats">
                <!-- HEX -->
                <div class="format-row" id="hex-section">
                    <span class="format-label">HEX</span>
                    <code class="format-value" id="hexValue">@Model.Formats.Hex</code>
                    <button class="btn-copy" onclick="copyToClipboard('hexValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- RGB -->
                <div class="format-row" id="rgb-section">
                    <span class="format-label">RGB</span>
                    <code class="format-value" id="rgbValue">@Model.Formats.RgbString</code>
                    <button class="btn-copy" onclick="copyToClipboard('rgbValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- RGB Percent -->
                <div class="format-row" id="rgb-percent-section">
                    <span class="format-label">RGB %</span>
                    <code class="format-value" id="rgbPercentValue">@Model.Formats.RgbPercentString</code>
                    <button class="btn-copy" onclick="copyToClipboard('rgbPercentValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- HSL -->
                <div class="format-row" id="hsl-section">
                    <span class="format-label">HSL</span>
                    <code class="format-value" id="hslValue">@Model.Formats.HslString</code>
                    <button class="btn-copy" onclick="copyToClipboard('hslValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- HSV -->
                <div class="format-row" id="hsv-section">
                    <span class="format-label">HSV</span>
                    <code class="format-value" id="hsvValue">@Model.Formats.HsvString</code>
                    <button class="btn-copy" onclick="copyToClipboard('hsvValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- CMYK -->
                <div class="format-row" id="cmyk-section">
                    <span class="format-label">CMYK</span>
                    <code class="format-value" id="cmykValue">@Model.Formats.CmykString</code>
                    <button class="btn-copy" onclick="copyToClipboard('cmykValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- XYZ -->
                <div class="format-row" id="xyz-section">
                    <span class="format-label">XYZ</span>
                    <code class="format-value" id="xyzValue">@Model.Formats.XyzString</code>
                    <button class="btn-copy" onclick="copyToClipboard('xyzValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- CIE Lab -->
                <div class="format-row" id="lab-section">
                    <span class="format-label">CIE Lab</span>
                    <code class="format-value" id="labValue">@Model.Formats.LabString</code>
                    <button class="btn-copy" onclick="copyToClipboard('labValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- CIE Luv -->
                <div class="format-row" id="luv-section">
                    <span class="format-label">CIE Luv</span>
                    <code class="format-value" id="luvValue">@Model.Formats.LuvString</code>
                    <button class="btn-copy" onclick="copyToClipboard('luvValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- Hunter Lab -->
                <div class="format-row" id="hunterlab-section">
                    <span class="format-label">Hunter Lab</span>
                    <code class="format-value" id="hunterLabValue">@Model.Formats.HunterLabString</code>
                    <button class="btn-copy" onclick="copyToClipboard('hunterLabValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- YIQ -->
                <div class="format-row" id="yiq-section">
                    <span class="format-label">YIQ</span>
                    <code class="format-value" id="yiqValue">@Model.Formats.YiqString</code>
                    <button class="btn-copy" onclick="copyToClipboard('yiqValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>

                <!-- Decimal -->
                <div class="format-row" id="decimal-section">
                    <span class="format-label">Decimal</span>
                    <code class="format-value" id="decimalValue">@Model.Formats.Decimal</code>
                    <button class="btn-copy" onclick="copyToClipboard('decimalValue', this)" title="@Localizer["Copy"]">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"/>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/>
                        </svg>
                    </button>
                </div>
            </div>

            <a class="btn btn-ghost mt-lg"
               asp-page="/ral-colors/Details"
               asp-route-culture="@RouteData.Values["culture"]"
               asp-route-colorIdentifier="@Model.SelectedColor.Slug">
                @Localizer["ViewDetails"] &rarr;
            </a>
        </div>
    }
    else if (!string.IsNullOrEmpty(ViewContext.HttpContext.Request.Query["ral"]))
    {
        <p class="text-secondary">@Localizer["NotFound"]</p>
    }
</div>

@section Scripts {
    <script src="~/js/color-autocomplete.js" asp-append-version="true"></script>
    <script>
        initColorAutocomplete('colorSearch', function(number, hex, name) {
            const currentUrl = new URL(window.location);
            currentUrl.searchParams.set('ral', number);
            window.location = currentUrl.toString();
        });

        function copyToClipboard(elementId, button) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(() => {
                button.classList.add('copied');
                setTimeout(() => button.classList.remove('copied'), 1500);
            });
        }
    </script>
}
